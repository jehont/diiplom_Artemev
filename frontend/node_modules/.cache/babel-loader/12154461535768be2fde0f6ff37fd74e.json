{"ast":null,"code":"import axios from \"axios\";\nimport { mapState } from \"vuex\";\nconst __default__ = {\n  name: \"Checkout\",\n\n  data() {\n    return {\n      checkoutObj: {\n        phone: \"\",\n        address: \"\",\n        paymentMethod: \"\"\n      },\n      cardObj: {\n        number: \"\",\n        name: \"\",\n        expiryDate: \"\",\n        cvv: \"\"\n      },\n      errorObj: {\n        phoneErr: [],\n        addressErr: [],\n        payErr: [],\n        numErr: [],\n        nameErr: [],\n        exDateErr: [],\n        cvvErr: []\n      },\n      cartItem: [],\n      itemQuantity: []\n    };\n  },\n\n  created() {\n    this.getAllCartItem();\n  },\n\n  computed: { ...mapState([\"allFoods\", \"user\"]),\n    filterFoods: function () {\n      return this.allFoods.filter(f => this.matchID(f, this.cartItem));\n    }\n  },\n  methods: {\n    availableTime: function () {\n      var now = new Date();\n      var currentMonth = (\"0\" + (now.getMonth() + 1)).slice(-2);\n      var minRange = now.getFullYear() + \"-\" + currentMonth;\n      var maxRange = now.getFullYear() + 10 + \"-\" + currentMonth;\n      document.getElementById(\"coCardEx\").setAttribute(\"min\", minRange);\n      document.getElementById(\"coCardEx\").setAttribute(\"max\", maxRange);\n    },\n    matchID: function (food, cartArray) {\n      let temp = \"\";\n      cartArray.forEach(element => {\n        if (parseInt(food.food_id) == element) {\n          temp = food;\n        }\n      });\n      return temp;\n    },\n    calculateSummaryPrice: function () {\n      let subtotal = 0;\n      let discount = 0;\n      let delivery = 15;\n      let i = 0;\n\n      while (i < this.itemQuantity.length) {\n        subtotal = subtotal + parseInt(this.filterFoods[i].food_price) * this.itemQuantity[i];\n        discount = discount + parseInt(this.filterFoods[i].food_discount) * this.itemQuantity[i];\n        i = i + 1;\n      }\n\n      if (!this.filterFoods.length) {\n        delivery = 0;\n      }\n\n      let total = subtotal - discount + delivery;\n      return [subtotal, discount, delivery, total];\n    },\n\n    async getAllCartItem() {\n      if (this.user) {\n        let existItem = await axios.get(\"/cartItem/\" + this.user.user_id);\n        existItem.data.forEach(element => {\n          this.cartItem.push(element.food_id);\n          this.itemQuantity.push(element.item_qty);\n        });\n      }\n    },\n\n    resetCheckErr: function () {\n      this.errorObj.phoneErr = [];\n      this.errorObj.addressErr = [];\n      this.errorObj.payErr = [];\n      this.errorObj.numErr = [];\n      this.errorObj.nameErr = [];\n      this.errorObj.exDateErr = [];\n      this.errorObj.cvvErr = [];\n    },\n    checkEmptyErr: function () {\n      for (var typeErr in this.errorObj) {\n        if (this.errorObj[typeErr].length != 0) {\n          return false;\n        }\n      }\n\n      return true;\n    },\n    inputUpcase: function (e) {\n      e.target.value = e.target.value.toUpperCase();\n    },\n    checkForm: function () {\n      this.resetCheckErr(); // Phone validate\n\n      if (!this.checkoutObj.phone) {\n        this.errorObj.phoneErr.push(\"Ввод номера телефона обязателен\");\n      } else {\n        if (!this.checkoutObj.phone.startsWith(\"7\")) {\n          this.errorObj.phoneErr.push(\"Номер телефона должен начинаться с 7\");\n        }\n\n        if (this.checkoutObj.phone.length != 11) {\n          this.errorObj.phoneErr.push(\"Требуется ввести адрес\");\n        }\n\n        if (!/[0-9]{11}/.test(this.checkoutObj.phone)) {\n          this.errorObj.phoneErr.push(\"Номера телефонов могут содержать только цифры\");\n        }\n      } // Address validate\n\n\n      if (!this.checkoutObj.address) {\n        this.errorObj.addressErr.push(\"Требуется ввести адрес\");\n      } // Card validate\n\n\n      if (!this.checkoutObj.paymentMethod) {\n        this.errorObj.payErr.push(\"Необходимо выбрать способ оплаты\");\n      } else if (this.checkoutObj.paymentMethod == \"card\") {\n        if (!this.cardObj.number) {\n          this.errorObj.numErr.push(\"Требуется ввод номера карты\");\n        } else {\n          if (!this.cardObj.number.startsWith(\"22\")) {\n            this.errorObj.numErr.push(\"Номера карт МИР должны начинаться с 22\");\n          }\n\n          if (this.cardObj.number.length != 16) {\n            this.errorObj.numErr.push(\"Номера карт МИР должны иметь 16 знаков\");\n          }\n\n          if (!/[0-9]{16}/.test(this.cardObj.number)) {\n            this.errorObj.numErr.push(\"Номера карт МИР могут содержать только цифры\");\n          }\n        }\n\n        if (!this.cardObj.name) {\n          this.errorObj.nameErr.push(\"Требуется ввести имя\");\n        } else {\n          if (!/^[А-Я а-я]+$/.test(this.cardObj.name.replace(/\\s/g, \"\"))) {\n            this.errorObj.nameErr.push(\"Имя может содержать только буквы\");\n          }\n        }\n\n        if (!this.cardObj.expiryDate) {\n          this.errorObj.exDateErr.push(\"Укажите дату истечения срока действия.\");\n        }\n\n        if (!this.cardObj.cvv) {\n          this.errorObj.cvvErr.push(\"Требуется ввести CVP-код\");\n        } else {\n          if (this.cardObj.cvv.length != 3) {\n            this.errorObj.cvvErr.push(\"CVP-код должен состоять ровно из 3 цифр.\");\n          }\n\n          if (!/[0-9]{3}/.test(this.cardObj.cvv)) {\n            this.errorObj.cvvErr.push(\"CVP-код может содержать только цифры\");\n          }\n        }\n      } else if (this.checkoutObj.paymentMethod == \"cash\") {\n        this.cardObj.number = \"\";\n        this.cardObj.name = \"\";\n        this.cardObj.expiryDate = \"\";\n        this.cardObj.cvv = \"\";\n        this.errorObj.numErr = [];\n        this.errorObj.nameErr = [];\n        this.errorObj.exDateErr = [];\n        this.errorObj.cvvErr = [];\n      }\n    },\n    isPaid: function () {\n      if (this.checkoutObj.paymentMethod == \"cash\") {\n        return \"false\";\n      } else if (this.checkoutObj.paymentMethod == \"card\") {\n        return \"true\";\n      }\n    },\n\n    async sendBillDetails(billId, foodId, qty) {\n      let billDetails = {\n        bill_id: parseInt(billId),\n        food_id: parseInt(foodId),\n        item_qty: parseInt(qty)\n      };\n      await axios.post(\"/billdetails\", billDetails);\n    },\n\n    async handleSubmit(e) {\n      this.checkForm();\n\n      if (!this.checkEmptyErr()) {\n        e.preventDefault();\n      } else {\n        e.preventDefault();\n        let billId = (await axios.get(\"/billstatus/new\")).data;\n\n        if (billId == \"\") {\n          billId = 1;\n        } else {\n          billId = parseInt(billId.bill_id) + 1;\n        }\n\n        this.cartItem.forEach((foodId, index) => {\n          this.sendBillDetails(billId, foodId, this.itemQuantity[index]);\n        });\n        var now = new Date();\n        var day = (\"0\" + now.getDate()).slice(-2);\n        var month = (\"0\" + (now.getMonth() + 1)).slice(-2);\n        var hour = (\"0\" + now.getHours()).slice(-2);\n        var min = (\"0\" + now.getMinutes()).slice(-2);\n        var currentTime = now.getFullYear() + \"-\" + month + \"-\" + day + \"T\" + hour + \":\" + min;\n        let billStatus = {\n          bill_id: parseInt(billId),\n          user_id: parseInt(this.user.user_id),\n          bill_phone: this.checkoutObj.phone,\n          bill_address: this.checkoutObj.address,\n          bill_when: currentTime,\n          bill_method: this.checkoutObj.paymentMethod,\n          bill_discount: parseInt(this.calculateSummaryPrice()[1]),\n          bill_delivery: parseInt(this.calculateSummaryPrice()[2]),\n          bill_total: parseInt(this.calculateSummaryPrice()[3]),\n          bill_paid: this.isPaid(),\n          bill_status: 1\n        };\n        axios.post(\"/billstatus\", billStatus);\n        axios.delete(\"/cartItem/\" + this.user.user_id);\n        this.cartItem = [];\n        this.itemQuantity = [];\n        this.$router.push(\"/thank\");\n      }\n    }\n\n  }\n};\nexport default /*#__PURE__*/Object.assign(__default__, {\n  setup(__props, {\n    expose\n  }) {\n    expose(); // enables v-focus in templates\n\n    const vUpcase = {\n      mounted(el) {\n        el.style.textTransform = \"uppercase\";\n      }\n\n    };\n    const __returned__ = {\n      vUpcase,\n      axios,\n      mapState\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n});","map":{"version":3,"mappings":"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","names":["axios","mapState","name","data","checkoutObj","phone","address","paymentMethod","cardObj","number","expiryDate","cvv","errorObj","phoneErr","addressErr","payErr","numErr","nameErr","exDateErr","cvvErr","cartItem","itemQuantity","created","getAllCartItem","computed","filterFoods","allFoods","filter","f","matchID","methods","availableTime","now","Date","currentMonth","getMonth","slice","minRange","getFullYear","maxRange","document","getElementById","setAttribute","food","cartArray","temp","forEach","element","parseInt","food_id","calculateSummaryPrice","subtotal","discount","delivery","i","length","food_price","food_discount","total","user","existItem","get","user_id","push","item_qty","resetCheckErr","checkEmptyErr","typeErr","inputUpcase","e","target","value","toUpperCase","checkForm","startsWith","test","replace","isPaid","sendBillDetails","billId","foodId","qty","billDetails","bill_id","post","handleSubmit","preventDefault","index","day","getDate","month","hour","getHours","min","getMinutes","currentTime","billStatus","bill_phone","bill_address","bill_when","bill_method","bill_discount","bill_delivery","bill_total","bill_paid","bill_status","delete","$router","vUpcase","mounted","el","style","textTransform"],"sources":["C:/Users/User/Desktop/restaurant-ordering-system-master/frontend/src/pages/Checkout.vue"],"sourcesContent":["<template>\n  <div class=\"checkout-container\">\n    <div class=\"checkout-form-container\">\n      <form\n        id=\"checkoutForm\"\n        @submit=\"handleSubmit\"\n        novalidate\n        autocomplete=\"off\"\n      >\n        <div class=\"checkout-heading\">\n          <h3>Еще несколько шагов, чтобы оформить заказ<span>Стоимость</span></h3>\n          <h3 v-if=\"user\">\n            {{ user.user_name }} ваш заказ<span\n              >₽{{ calculateSummaryPrice()[3] }}</span\n            >\n          </h3>\n        </div>\n\n        <div class=\"form-group details-group\">\n          <h4>Детали заказа</h4>\n          <div class=\"form-group\">\n            <input\n              type=\"text\"\n              name=\"coPhone\"\n              id=\"coPhone\"\n              placeholder=\"Ваш номер телефона\"\n              class=\"form-control\"\n              v-model=\"checkoutObj.phone\"\n            />\n            <p class=\"error-mess\" v-if=\"errorObj.phoneErr.length > 0\">\n              {{ errorObj.phoneErr[0] }}\n            </p>\n          </div>\n\n          <div class=\"form-group\">\n            <input\n              type=\"text\"\n              name=\"coAddress\"\n              id=\"coAddress\"\n              placeholder=\"Адрес доставки\"\n              class=\"form-control\"\n              v-model=\"checkoutObj.address\"\n            />\n            <p class=\"error-mess\" v-if=\"errorObj.addressErr.length > 0\">\n              {{ errorObj.addressErr[0] }}\n            </p>\n          </div>\n        </div>\n\n        <div class=\"form-group details-group\">\n          <h4>Способ оплаты</h4>\n          <div class=\"form-group\">\n            <div class=\"form-group\">\n              <input\n                type=\"radio\"\n                name=\"payment\"\n                value=\"cash\"\n                id=\"paymentCash\"\n                v-model=\"checkoutObj.paymentMethod\"\n              /><span>Наличные</span>\n              <input\n                type=\"radio\"\n                name=\"payment\"\n                value=\"card\"\n                id=\"paymentCard\"\n                v-model=\"checkoutObj.paymentMethod\"\n              /><span>Карта(Мир)</span>\n            </div>\n            <p class=\"error-mess\" v-if=\"errorObj.payErr.length > 0\">\n              {{ errorObj.payErr[0] }}\n            </p>\n          </div>\n\n          <div v-if=\"checkoutObj.paymentMethod == 'card'\">\n            <div class=\"form-group\">\n              <input\n                type=\"text\"\n                name=\"coCardNum\"\n                placeholder=\"Введите номер карты\"\n                id=\"coCardNum\"\n                class=\"form-control\"\n                v-model=\"cardObj.number\"\n                size=\"16\"\n                maxlength=\"16\"\n              />\n              <p class=\"error-mess\" v-if=\"errorObj.numErr.length > 0\">\n                {{ errorObj.numErr[0] }}\n              </p>\n            </div>\n\n            <div class=\"form-group\">\n              <input\n                v-upcase\n                type=\"text\"\n                name=\"coCardName\"\n                placeholder=\"Имя владельца карты \"\n                id=\"coCardName\"\n                class=\"form-control\"\n                v-model=\"cardObj.name\"\n              />\n              <p class=\"error-mess\" v-if=\"errorObj.nameErr.length > 0\">\n                {{ errorObj.nameErr[0] }}\n              </p>\n            </div>\n\n            <div class=\"form-group\">\n              <div class=\"form-control\">\n                <span\n                  style=\"\n                    font-size: 1.4rem;\n                    position: absolute;\n                    margin-left: -5px;\n                    margin-top: -11px;\n                  \"\n                  >Срок действия:\n                </span>\n                <input\n                  style=\"\n                    position: absolute;\n                    margin-left: 120px;\n                    margin-top: 0px;\n                    background: inherit;\n                  \"\n                  type=\"month\"\n                  name=\"coCardEx\"\n                  id=\"coCardEx\"\n                  v-model=\"cardObj.expiryDate\"\n                  @click=\"availableTime()\"\n                />\n              </div>\n              <p class=\"error-mess\" v-if=\"errorObj.exDateErr.length > 0\">\n                {{ errorObj.exDateErr[0] }}\n              </p>\n            </div>\n\n            <div class=\"form-group\">\n              <input\n                type=\"text\"\n                name=\"coCardCvv\"\n                placeholder=\"CVV\"\n                id=\"coCardCvv\"\n                class=\"form-control\"\n                v-model=\"cardObj.cvv\"\n              />\n              <p class=\"error-mess\" v-if=\"errorObj.cvvErr.length > 0\">\n                {{ errorObj.cvvErr[0] }}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div v-if=\"user\" class=\"form-group\">\n          <input\n            type=\"submit\"\n            value=\"Подтвердить и заплатить\"\n            class=\"btn\"\n            :disabled=\"filterFoods.length ? false : true\"\n          />\n        </div>\n      </form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport { mapState } from \"vuex\";\nexport default {\n  name: \"Checkout\",\n\n  data() {\n    return {\n      checkoutObj: { phone: \"\", address: \"\", paymentMethod: \"\" },\n      cardObj: { number: \"\", name: \"\", expiryDate: \"\", cvv: \"\" },\n      errorObj: {\n        phoneErr: [],\n        addressErr: [],\n        payErr: [],\n        numErr: [],\n        nameErr: [],\n        exDateErr: [],\n        cvvErr: [],\n      },\n      cartItem: [],\n      itemQuantity: [],\n    };\n  },\n\n  created() {\n    this.getAllCartItem();\n  },\n\n  computed: {\n    ...mapState([\"allFoods\", \"user\"]),\n\n    filterFoods: function () {\n      return this.allFoods.filter((f) => this.matchID(f, this.cartItem));\n    },\n  },\n\n  methods: {\n    availableTime: function () {\n      var now = new Date();\n      var currentMonth = (\"0\" + (now.getMonth() + 1)).slice(-2);\n\n      var minRange = now.getFullYear() + \"-\" + currentMonth;\n      var maxRange = now.getFullYear() + 10 + \"-\" + currentMonth;\n\n      document.getElementById(\"coCardEx\").setAttribute(\"min\", minRange);\n      document.getElementById(\"coCardEx\").setAttribute(\"max\", maxRange);\n    },\n\n    matchID: function (food, cartArray) {\n      let temp = \"\";\n      cartArray.forEach((element) => {\n        if (parseInt(food.food_id) == element) {\n          temp = food;\n        }\n      });\n      return temp;\n    },\n\n    calculateSummaryPrice: function () {\n      let subtotal = 0;\n      let discount = 0;\n      let delivery = 15;\n      let i = 0;\n      while (i < this.itemQuantity.length) {\n        subtotal =\n          subtotal +\n          parseInt(this.filterFoods[i].food_price) * this.itemQuantity[i];\n        discount =\n          discount +\n          parseInt(this.filterFoods[i].food_discount) * this.itemQuantity[i];\n        i = i + 1;\n      }\n      if (!this.filterFoods.length) {\n        delivery = 0;\n      }\n      let total = subtotal - discount + delivery;\n      return [subtotal, discount, delivery, total];\n    },\n\n    async getAllCartItem() {\n      if (this.user) {\n        let existItem = await axios.get(\"/cartItem/\" + this.user.user_id);\n        existItem.data.forEach((element) => {\n          this.cartItem.push(element.food_id);\n          this.itemQuantity.push(element.item_qty);\n        });\n      }\n    },\n\n    resetCheckErr: function () {\n      this.errorObj.phoneErr = [];\n      this.errorObj.addressErr = [];\n      this.errorObj.payErr = [];\n      this.errorObj.numErr = [];\n      this.errorObj.nameErr = [];\n      this.errorObj.exDateErr = [];\n      this.errorObj.cvvErr = [];\n    },\n\n    checkEmptyErr: function () {\n      for (var typeErr in this.errorObj) {\n        if (this.errorObj[typeErr].length != 0) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    inputUpcase: function (e) {\n      e.target.value = e.target.value.toUpperCase();\n    },\n\n    checkForm: function () {\n      this.resetCheckErr();\n\n      // Phone validate\n      if (!this.checkoutObj.phone) {\n        this.errorObj.phoneErr.push(\"Ввод номера телефона обязателен\");\n      } else {\n        if (!this.checkoutObj.phone.startsWith(\"7\")) {\n          this.errorObj.phoneErr.push(\"Номер телефона должен начинаться с 7\");\n        }\n\n        if (this.checkoutObj.phone.length != 11) {\n          this.errorObj.phoneErr.push(\n            \"Требуется ввести адрес\"\n          );\n        }\n\n        if (!/[0-9]{11}/.test(this.checkoutObj.phone)) {\n          this.errorObj.phoneErr.push(\"Номера телефонов могут содержать только цифры\");\n        }\n      }\n\n      // Address validate\n      if (!this.checkoutObj.address) {\n        this.errorObj.addressErr.push(\"Требуется ввести адрес\");\n      }\n\n      // Card validate\n      if (!this.checkoutObj.paymentMethod) {\n        this.errorObj.payErr.push(\"Необходимо выбрать способ оплаты\");\n      } else if (this.checkoutObj.paymentMethod == \"card\") {\n        if (!this.cardObj.number) {\n          this.errorObj.numErr.push(\"Требуется ввод номера карты\");\n        } else {\n          if (!this.cardObj.number.startsWith(\"22\")) {\n            this.errorObj.numErr.push(\"Номера карт МИР должны начинаться с 22\");\n          }\n\n          if (this.cardObj.number.length != 16) {\n            this.errorObj.numErr.push(\n              \"Номера карт МИР должны иметь 16 знаков\"\n            );\n          }\n\n          if (!/[0-9]{16}/.test(this.cardObj.number)) {\n            this.errorObj.numErr.push(\n              \"Номера карт МИР могут содержать только цифры\"\n            );\n          }\n        }\n\n        if (!this.cardObj.name) {\n          this.errorObj.nameErr.push(\"Требуется ввести имя\");\n        } else {\n          if (!/^[А-Я а-я]+$/.test(this.cardObj.name.replace(/\\s/g, \"\"))) {\n            this.errorObj.nameErr.push(\"Имя может содержать только буквы\");\n          }\n        }\n\n        if (!this.cardObj.expiryDate) {\n          this.errorObj.exDateErr.push(\"Укажите дату истечения срока действия.\");\n        }\n\n        if (!this.cardObj.cvv) {\n          this.errorObj.cvvErr.push(\"Требуется ввести CVP-код\");\n        } else {\n          if (this.cardObj.cvv.length != 3) {\n            this.errorObj.cvvErr.push(\"CVP-код должен состоять ровно из 3 цифр.\");\n          }\n\n          if (!/[0-9]{3}/.test(this.cardObj.cvv)) {\n            this.errorObj.cvvErr.push(\"CVP-код может содержать только цифры\");\n          }\n        }\n      } else if (this.checkoutObj.paymentMethod == \"cash\") {\n        this.cardObj.number = \"\";\n        this.cardObj.name = \"\";\n        this.cardObj.expiryDate = \"\";\n        this.cardObj.cvv = \"\";\n\n        this.errorObj.numErr = [];\n        this.errorObj.nameErr = [];\n        this.errorObj.exDateErr = [];\n        this.errorObj.cvvErr = [];\n      }\n    },\n\n    isPaid: function () {\n      if (this.checkoutObj.paymentMethod == \"cash\") {\n        return \"false\";\n      } else if (this.checkoutObj.paymentMethod == \"card\") {\n        return \"true\";\n      }\n    },\n\n    async sendBillDetails(billId, foodId, qty) {\n      let billDetails = {\n        bill_id: parseInt(billId),\n        food_id: parseInt(foodId),\n        item_qty: parseInt(qty),\n      };\n\n      await axios.post(\"/billdetails\", billDetails);\n    },\n\n    async handleSubmit(e) {\n      this.checkForm();\n\n      if (!this.checkEmptyErr()) {\n        e.preventDefault();\n      } else {\n        e.preventDefault();\n        let billId = (await axios.get(\"/billstatus/new\")).data;\n\n        if (billId == \"\") {\n          billId = 1;\n        } else {\n          billId = parseInt(billId.bill_id) + 1;\n        }\n\n        this.cartItem.forEach((foodId, index) => {\n          this.sendBillDetails(billId, foodId, this.itemQuantity[index]);\n        });\n\n        var now = new Date();\n        var day = (\"0\" + now.getDate()).slice(-2);\n        var month = (\"0\" + (now.getMonth() + 1)).slice(-2);\n        var hour = (\"0\" + now.getHours()).slice(-2);\n        var min = (\"0\" + now.getMinutes()).slice(-2);\n        var currentTime =\n          now.getFullYear() + \"-\" + month + \"-\" + day + \"T\" + hour + \":\" + min;\n\n        let billStatus = {\n          bill_id: parseInt(billId),\n          user_id: parseInt(this.user.user_id),\n          bill_phone: this.checkoutObj.phone,\n          bill_address: this.checkoutObj.address,\n          bill_when: currentTime,\n          bill_method: this.checkoutObj.paymentMethod,\n          bill_discount: parseInt(this.calculateSummaryPrice()[1]),\n          bill_delivery: parseInt(this.calculateSummaryPrice()[2]),\n          bill_total: parseInt(this.calculateSummaryPrice()[3]),\n          bill_paid: this.isPaid(),\n          bill_status: 1,\n        };\n\n        axios.post(\"/billstatus\", billStatus);\n        axios.delete(\"/cartItem/\" + this.user.user_id);\n\n        this.cartItem = [];\n        this.itemQuantity = [];\n\n        this.$router.push(\"/thank\");\n      }\n    },\n  },\n};\n</script>\n\n<script setup>\n// enables v-focus in templates\nconst vUpcase = {\n  mounted(el) {\n    el.style.textTransform = \"uppercase\";\n  },\n};\n</script>\n\n<style scoped>\n.checkout-container {\n  padding: 2rem 9%;\n}\n\n.checkout-container .checkout-form-container {\n  background: #fff;\n  height: 90vh;\n}\n\n.checkout-container .checkout-form-container form {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -42%);\n  max-width: 70rem;\n  width: 100%;\n  box-shadow: 0 1rem 1rem rgba(0, 0, 0, 0.05);\n  border: 0.1rem solid rgba(0, 0, 0, 0.2);\n  padding: 2rem;\n  border-radius: 0.5rem;\n  animation: fadeUp 0.4s linear;\n}\n\n.checkout-container .checkout-form-container form h3 {\n  padding-bottom: 1rem;\n  font-size: 2rem;\n  text-transform: uppercase;\n  color: #130f40;\n  margin: 0;\n}\n\n.checkout-container .checkout-form-container form .form-control {\n  margin: 0.7rem 0;\n  border-radius: 0.5rem;\n  background: #f7f7f7;\n  padding: 2rem 1.2rem;\n  font-size: 1.6rem;\n  color: #130f40;\n  text-transform: none;\n  width: 100%;\n  border: none;\n}\n\n.checkout-container .checkout-form-container form label {\n  font-size: 2rem;\n  margin: 0;\n  padding: 0;\n}\n\n.checkout-container .checkout-form-container form span {\n  font-size: 18px;\n  padding-left: 5px;\n  padding-right: 40px;\n}\n\n.checkout-container .checkout-form-container form .btn {\n  margin: 1rem 0;\n  width: 100%;\n  text-align: center;\n}\n\n.checkout-container .checkout-form-container form p {\n  padding-top: 1rem;\n  font-size: 1.5rem;\n  color: #666;\n  margin: 0;\n}\n\n.checkout-container .checkout-form-container form p a {\n  color: #27ae60;\n}\n\n.checkout-container .checkout-form-container form p a:hover {\n  color: #130f40;\n  text-decoration: underline;\n}\n\n.checkout-container .checkout-form-container form .form-group {\n  margin: 0;\n}\n\n.checkout-container .checkout-form-container form .form-group.details-group {\n  margin-top: 40px;\n}\n\n.checkout-container .checkout-form-container form .form-group .error-mess {\n  font-size: 1.5rem;\n  position: relative;\n  color: rgb(243, 47, 47);\n  margin: 0;\n  padding: 0;\n}\n\n.checkout-container .checkout-form-container form .checkout-heading h3 {\n  display: flex;\n  justify-content: space-between;\n}\n\n.checkout-container .checkout-form-container form .checkout-heading h3 span {\n  padding-right: 0px;\n  color: #f38609;\n}\n\n.checkout-container\n  .checkout-form-container\n  form\n  .checkout-heading\n  h3:first-of-type\n  span {\n  padding-right: 0px;\n  color: #130f40;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}